<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no" />
    <meta name="description" content="" />
    <meta name="author" content="" />
    <title>Projects- SKT Admin</title>
    <link href="css/styles.css" rel="stylesheet" />
    <link href="css/dataTables.bootstrap4.min.css" rel="stylesheet" crossorigin="anonymous" />
    <script defer src="fontawesome-free-5.15.1-web/js/all.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css" integrity="sha512-Cv93isQdFwaKBV+Z4X8kaVBYWHST58Xb/jVOcV9aRsGSArZsgAnFIhMpDoMDcFNoUtday1hdjn0nGp3+KZyyFw==" crossorigin="anonymous" />
</head>

<body class="sb-nav-fixed">
    <nav class="sb-topnav navbar navbar-expand navbar-dark bg-dark">
        <a class="navbar-brand" href="index.html"> <img src="./images/logo-300x67.png" alt="" srcset="" height="50"
                width="200"> </a>
        <button class="btn btn-link btn-sm order-1 order-lg-0" id="sidebarToggle" href="#"><i
                class="fas fa-bars"></i></button>
        <form class="d-none d-md-inline-block form-inline ml-auto mr-0 mr-md-3 my-2 my-md-0">
            <div class="input-group">
                <input class="form-control" type="text" placeholder="Search for..." aria-label="Search"
                    aria-describedby="basic-addon2" />
                <div class="input-group-append">
                    <button class="btn " style="background-color: #72736E;" type="button"><i
                            class="fas fa-search"></i></button>
                </div>
            </div>
        </form>
        <div class="nav-item dropdown" style="float: right; margin-top: 5px;">
            <a class="nav-link dropdown-toggle" href="http://example.com" id="dropdown09" data-toggle="dropdown"
                aria-haspopup="true" aria-expanded="false"><span class="flag-icon flag-icon-us"> </span>
                English</a>
            <div class="dropdown-menu" aria-labelledby="dropdown09">
                <a class="dropdown-item" href="#fr"><span class="flag-icon flag-icon-fr"> </span> French</a>
                
            </div>
        </div>
        
        <ul class="navbar-nav ml-auto ml-md-0">
            <li class="nav-item dropdown">
                <a class="nav-link dropdown-toggle" id="userDropdown" href="#" role="button" data-toggle="dropdown"
                    aria-haspopup="true" aria-expanded="false"><i class="fas fa-user fa-fw"></i></a>
                <div class="dropdown-menu dropdown-menu-right" aria-labelledby="userDropdown">
                    <a class="dropdown-item" href="#">Settings</a>
                    <a class="dropdown-item" href="#">Activity Log</a>
                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="login.html">Logout</a>
                </div>
            </li>
        </ul>
    </nav>
    <div id="layoutSidenav">
        <div id="layoutSidenav_nav">
            <nav class="sb-sidenav accordion sb-sidenav-dark" id="sidenavAccordion">
                <div class="sb-sidenav-menu">
                    <div class="nav">
                        <a class="nav-link" href="project.html">
                            <div class="sb-nav-link-icon"><i class="fas fa-project-diagram"></i></div>
                            Projects
                        </a>
                       
                    </div>
                </div>
                <div class="sb-sidenav-footer">
                    <div class="small">Logged in as:</div>
                    Start Bootstrap
                </div>
            </nav>
        </div>
        <div id="layoutSidenav_content">

            <main>
                <div class="container-fluid" >
                    <a href="#" class="  d-sm-inline-block text-center py-2 px-2 mt-3 rounded text-white add-projects"
                        data-toggle="modal" data-target="#addprojects" style="float: right;background-color: #72736E;">
                        <i class="fas fa-plus-circle align-middle text-white"></i> <span>Add Projects</span>
                    </a>

                </div>
                <div class="modal fade" id="addprojects">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <div class="modal-header" style="background-color: #72736E;">
                                <h5 class="modal-title">
                                    <i class="fas fa-plus-circle"></i> Add Projects
                                </h5>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>

                            <form class="add-projects" onsubmit="addProject(event)">
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label for="Project-name" class="col-form-label"> Add Project name</label>
                                        <input type="text" class="form-control" id="project-name" name="projectName">
                                    </div>


                                    <div class="form-group">
                                        <label for="task-name" class="col-form-label">Add team lead</label>
                                        <select class="custom-select"  name="projectTeamlead"> 
                                            <option>Eric Osei</option>
                                            <option >Evenlyn Mensah</option>
                                            <option >John frimpong</option>
                                            <option >Happy Sefa</option>
                                            <option >George Prepah</option>
                                            <option >Henry Okoh</option>
                                          </select>
                                        

                                    </div>
                                    <div class="form-group">
                                        <select class="custom-select"  name="projectType"> 
                                          <option>Crop Monitoring</option>
                                          <option >Crop Spraying</option>
                                          <option >Mapping and Surveying</option>
                                          <option >3D Modeling</option>
                                          <option >Asset Inspection</option>
                                          <option >Drone Maintenance</option>
                                        </select>
                                        
                                      </div>
                                      <div class="form-group">
                                        <label for="project-name" class="col-form-label">Add Start date</label>
                                        <input type="date" class="form-control" id="project-name" name="projectStartdate">

                                    </div>
                                    <div class="form-group">
                                        <label for="project-name" class="col-form-label">Add due date</label>
                                        <input type="date" class="form-control" id="project-name" name="projectDuedate">

                                    </div>
                                    <div class="form-group">
                                        <label for="project-budget" class="col-form-label">Add Budget</label>
                                        <input type="number" class="form-control" id="project-budget"
                                            name="projectBudget">
                                    </div>
                                    <div class="form-group">
                                        <select class="custom-select"  name="projectStatus"> 
                                          <option>On going</option>
                                          <option >Completed</option>
                                          <option >On hold</option>
                                        </select>
                                        
                                      </div>

                                </div>
                                <div class="modal-footer">
                                    <button id="submit-button" type="submit" class="btn font-weight-bold send-email"
                                        style="background-color: #72736E;">Save</button>
                                </div>
                            </form>


                        </div>
                    </div>
                </div>
                <h1 class="mt-4">Projects</h1>
                <div class="card-body">
                    <div class="table-responsive" style="width: 98%; background-color: #ffff;">
                        <table class="table" id="dataTable" width="100%" cellspacing="0">
                            <thead style="background-color: #72736E;">
                                <tr>
                                    <th>Project Name </th>
                                    <th>Team Lead</th>
                                    <th>Project Type</th>
                                    <th>Start Date</th>
                                    <th>Due Date</th>
                                    <th>Budget</th>
                                    <th>Status</th>
                                </tr>
                            </thead>

                            <tbody id="allprojects">
                                
                               
                            </tbody>
                        </table>
                    </div>
                </div>
        </div>
    </div>
    </main>

    </div>
    </div>
    
    <footer class="py-4 bg-light mt-auto">
        <div class="container-fluid">
            <div class="d-flex align-items-center justify-content-between small">
                <div class="text-muted">Copyright &copy; SKT AeroShutter 2020  <img src="images/logo-300x67.png" width="50px"  alt=""> </div>
                <div>
                    <a href="#">Privacy Policy</a>
                    &middot;
                    <a href="#">Terms &amp; Conditions</a>
                </div>
            </div>
        </div>
      </footer>

    <script src="js/jquery-3.5.1.slim.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/scripts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.min.js" crossorigin="anonymous"></script>
    <script src="https://cdn.datatables.net/1.10.20/js/dataTables.bootstrap4.min.js" crossorigin="anonymous"></script>
    <script src="assets/demo/datatables-demo.js"></script>

    <!-- The core Firebase JS SDK is always required and must be listed first -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-app.js"></script>

    <!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
    <script src="https://www.gstatic.com/firebasejs/8.1.1/firebase-firestore.js"></script>

    <script>
        // Your web app's Firebase configuration
        var firebaseConfig = {
            apiKey: "AIzaSyAiyqidqSCOQDE090C2ZraA-R5WI9DK5GA",
            authDomain: "hacinta-94edb.firebaseapp.com",
            databaseURL: "https://hacinta-94edb.firebaseio.com",
            projectId: "hacinta-94edb",
            storageBucket: "hacinta-94edb.appspot.com",
            messagingSenderId: "58100753918",
            appId: "1:58100753918:web:d8a99f59676d2306b90caf"
        };   
        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
    </script>
    <script>
        var db = firebase.firestore();


        function addProject(event) {
            event.preventDefault();
            $('#submit-button').attr("disabled", true)
            db.collection('projects')
                .add({
                    projectName: event.target.projectName.value,
                    projectTeamlead: event.target.projectTeamlead.value,
                    projectType: event.target.projectType.value,
                    projectStartdate: event.target.projectStartdate.value,
                    projectDuedate: event.target.projectDuedate.value,
                    projectBudget: event.target.projectBudget.value,
                    projectStatus:event.target.projectStatus.value,
                    
                })
                .then(function (docRef) {
                    console.log('Document written with ID: ', docRef.id);
                    window.location.href = 'project.html'
                })
                .catch(function (error) {
                    console.error('Error adding document: ', error);
                });
        }

        function getAllProjects() {
            var projectsTable = document.getElementById('allprojects');
            const queryString = window.location.search;
            const urlParams = new URLSearchParams(queryString);
            const param = urlParams.get('category');
            let firestoreRef = db.collection("projects");
            if(param){
                firestoreRef = firestoreRef.where('projectType','==',param);
            }
            firestoreRef.onSnapshot((querySnapshot) => {
                projectsTable.innerHTML = '';
                let num = 0;
                querySnapshot.forEach((doc) => {
                    // console.log(`${doc.id} => ${doc.data().projectName}`);
                    let data = doc.data();
                    console.log(data);
                    let newRow = `
                    <tr>
                                    <td><a href="projectview.html?name=${data.projectName}&id=${doc.id}">${data.projectName}</a></td>
                                    <td>${data.projectTeamlead}</a></td>
                                    <td>${data.projectType}</td>
                                     <td>${data.projectStartdate}</td>
                                    <td>${data.projectDuedate}</td>
                                    <td>$${data.projectBudget}</td>
                                    <td>
                                        ${data.projectStatus}  
                                    </td>
                                    <td >
                                    <div class="dropdown">
                                    <button type="button" class="btn btn-sm btn-icon btn-secondary" data-toggle="dropdown"
                                        aria-haspopup="true" aria-expanded="false"><i class="fa fa-fw fa-ellipsis-h"></i></button>
                                    <div class="dropdown-menu dropdown-menu-right">
                                        <div class="dropdown-arrow mr-n1"></div>
                                        <a href="#" data-toggle="modal" data-target="#editproject${num}" class="dropdown-item">Edit</a>
                                        <a class="dropdown-item" onclick="deleteProject('${doc.id}')">Delete</a>
                                    </div>
                                    </div>

                                    <div class="modal fade" id="editproject${num++}">
                                        <div class="modal-dialog modal-dialog-centered">
                                            <div class="modal-content">
                                                <div class="modal-header" style="background-color: #72736E;">
                                                    <h5 class="modal-title">
                                                        <i class="fas fa-plus-circle"></i> Edit Project
                                                    </h5>
                                                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                        <i class="fas fa-times"></i>
                                                    </button>
                                                </div>

                                                <form class="add-projects" onsubmit="editProject(event, '${doc.id}')">
                                                    <div class="modal-body">
                                                        <div class="form-group">
                                                            <label for="Project-name" class="col-form-label"> Add Project name</label>
                                                            <input type="text" value="${data.projectName}" class="form-control" name="projectName">
                                                        </div>


                                                        <div class="form-group">
                                                            <label for="task-name" class="col-form-label">Add team lead</label>
                                                            <select class="custom-select"  name="projectTeamlead">
                                                            <option>${data.projectTeamlead}</option>
                                                                <option>Eric Osei</option>
                                                                <option >Evenlyn Mensah</option>
                                                                <option >John frimpong</option>
                                                                <option >Happy Sefa</option>
                                                                <option >George Prepah</option>
                                                                <option >Henry Okoh</option>
                                                            </select>
                                                            

                                                        </div>
                                                        <div class="form-group">
                                                            <select class="custom-select"  name="projectType"> 
                                                            <option>${data.projectType}</option>
                                                            <option>Crop Monitoring</option>
                                                            <option >Crop Spraying</option>
                                                            <option >Mapping and Surveying</option>
                                                            <option >3D Modeling</option>
                                                            <option >Asset Inspection</option>
                                                            <option >Drone Maintenance</option>
                                                            </select>
                                                            
                                                        </div>
                                                        <div class="form-group">
                                                            <label for="project-name" class="col-form-label">Add Start date</label>
                                                            <input type="date" value="${data.projectStartdate}" class="form-control" id="project-name" name="projectStartdate">

                                                        </div>
                                                        <div class="form-group">
                                                            <label for="project-name" class="col-form-label">Add due date</label>
                                                            <input type="date" value="${data.projectDuedate}" class="form-control" id="project-name" name="projectDuedate">

                                                        </div>
                                                        <div class="form-group">
                                                            <label for="project-budget" class="col-form-label">Add Budget</label>
                                                            <input type="number"  value="${data.projectBudget}" class="form-control" id="project-budget"
                                                                name="projectBudget">
                                                        </div>
                                                    <div class="form-group">
                                                        <select class="custom-select" value="${data.projectStatus}"  name="projectStatus"> 
                                                        <option>On going</option>
                                                        <option >Completed</option>
                                                        <option >On hold</option>
                                                        </select>
                                                        
                                                    </div>
                                                    </div>
                                                    <div class="modal-footer">
                                                        <button  type="submit" class="btn font-weight-bold send-email"
                                                            style="background-color: #72736E;">Update</button>
                                                    </div>
                                                </form>


                                            </div>
                                        </div>
                                    </div>
                                    </td>
                                    
                                    
                                </tr>
                    `
                    projectsTable.innerHTML = projectsTable.innerHTML + newRow
                });
            });
        }

        
        function editProject(event,id) {
            console.log('hh');
            event.preventDefault();
            $('#submit-button').attr("disabled", true)
            db.collection('projects').doc(id)
                .update({
                    projectName: event.target.projectName.value,
                    projectTeamlead: event.target.projectTeamlead.value,
                    projectType: event.target.projectType.value,
                    projectStartdate: event.target.projectStartdate.value,
                    projectDuedate: event.target.projectDuedate.value,
                    projectBudget: event.target.projectBudget.value,
                    projectStatus:event.target.projectStatus.value,
                    
                })
                .then(function (docRef) {
                    window.location.href = 'project.html'
                })
                .catch(function (error) {
                    console.error('Error adding document: ', error);
                });
        }


        function deleteProject(id) {
            db.collection("projects").doc(id).delete().then(function () {
                console.log("Document successfully deleted!");
            }).catch(function (error) {
                console.error("Error removing document: ", error);
            });
        }

        getAllProjects()

    </script>
</body>

</html>